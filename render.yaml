# Render Blueprint - Configuration de d√©ploiement
# https://render.com/docs/blueprint-spec

services:
  # Backend Phoenix API
  - type: web
    name: nesti-api
    runtime: docker
    region: frankfurt  # üá™üá∫ EU pour conformit√© RGPD
    plan: starter  # $7/mois - ou "free" pour tester
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    healthCheckPath: /api/health

    # Build settings
    buildFilter:
      paths:
        - backend/**

    # Autoscaling (optionnel, pour plan payant)
    scaling:
      minInstances: 1
      maxInstances: 3
      targetMemoryPercent: 80
      targetCPUPercent: 80

    # Variables d'environnement
    envVars:
      # Elixir/Phoenix
      - key: MIX_ENV
        value: prod
      - key: PORT
        value: 4000
      - key: PHX_SERVER
        value: true

      # Secrets (g√©n√©r√©s automatiquement)
      - key: SECRET_KEY_BASE
        generateValue: true
      - key: GUARDIAN_SECRET
        generateValue: true

      # Secrets (√† configurer manuellement)
      - key: ENCRYPTION_KEY
        sync: false  # ‚ö†Ô∏è Minimum 32 caract√®res
      - key: DATABASE_URL
        sync: false  # URL PostgreSQL Supabase
      - key: OPENAI_API_KEY
        sync: false  # Cl√© API OpenAI

      # Configuration
      - key: PHX_HOST
        sync: false  # Ex: nesti-api.onrender.com
      - key: POOL_SIZE
        value: 10

      # S√©curit√©
      - key: SECURE_COOKIES
        value: true
      - key: FORCE_SSL
        value: true

# Base de donn√©es (optionnel - on utilise Supabase)
# databases:
#   - name: nesti-db
#     plan: starter
#     region: frankfurt
